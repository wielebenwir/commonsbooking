class BookingList{constructor(e){this.currentPage=1,this.totalPages=0,this.loadMoreButton=document.getElementById("load-more-button"),this.pagination=document.getElementById("booking-list--pagination"),this.element=e,this.users=Array.from(document.querySelectorAll(".filter-users option")),this.items=Array.from(document.querySelectorAll(".filter-items option")),this.locations=Array.from(document.querySelectorAll(".filter-locations option")),this.states=Array.from(document.querySelectorAll(".filter-statuss option")),this.startDate=document.querySelector(".filter-startdate input"),jQuery("#startDate-datepicker").datepicker({dateFormat:"yy-mm-dd",altFormat:"@",altField:"#startDate"}),jQuery("#startDate-datepicker").datepicker("setDate",new Date),this.endDate=document.querySelector(".filter-enddate input"),jQuery("#endDate-datepicker").datepicker({dateFormat:"yy-mm-dd",altFormat:"@",altField:"#endDate"}),this.filters={users:[],items:[],locations:[],startDate:[],endDate:[],states:[]},this.shuffle=new Shuffle(e),this._resetListParams(),this._addSorting(),this._reloadData(),this._bindEventListeners()}_resetListParams(){this.listParams=new FormData,this.listParams.append("_ajax_nonce",cb_ajax_bookings.nonce),this.listParams.append("action","cb_bookings_data"),this.listParams.append("page",1)}_bindEventListeners(){this._onFilterReset=this._handleFilterReset.bind(this);var e=jQuery("#reset-filters"),e=(e&&e.on("click",this._onFilterReset),this._onFilter=this.filter.bind(this),jQuery("#filter")),e=(e&&e.on("click",this._onFilter),this._onUserChange=this._handleUserChange.bind(this),document.querySelectorAll(".filter-users select")),e=(e&&e.item(0).addEventListener("change",this._onUserChange),this._onItemChange=this._handleItemChange.bind(this),document.querySelectorAll(".filter-items select")),e=(e&&e.item(0).addEventListener("change",this._onItemChange),this._onLocationChange=this._handleLocationChange.bind(this),document.querySelectorAll(".filter-locations select")),e=(e&&e.item(0).addEventListener("change",this._onLocationChange),this._onStatusChange=this._handleStatusChange.bind(this),document.querySelectorAll(".filter-statuss select")),e=(e&&e.item(0).addEventListener("change",this._onStatusChange),this._onStartDateChange=this._handleStartDateChange.bind(this),jQuery("#startDate-datepicker")),e=(e&&(e.datepicker("option","onSelect",this._onStartDateChange),e.change(this._onStartDateChange)),this._onEndDateChange=this._handleEndDateChange.bind(this),jQuery("#endDate-datepicker")),e=(e&&(e.datepicker("option","onSelect",this._onEndDateChange),e.change(this._onEndDateChange)),this._onMenuButton=this._handleMenuButton.bind(this),jQuery("#cb-bookingdropbtn"));e&&e.on("click",this._onMenuButton)}_handleStartDateChange(){var e;this.filters.startDate=[],jQuery("#startDate-datepicker").datepicker("getDate")&&(e=parseInt(document.querySelector("#startDate").value.slice(0,-3))+3600,this.filters.startDate=[e+""])}_handleEndDateChange(){var e;this.filters.endDate=[],jQuery("#endDate-datepicker").datepicker("getDate")&&(e=parseInt(document.querySelector("#endDate").value.slice(0,-3))+3600,this.filters.endDate=[e+""])}_handleUserChange(){this.filters.users=this._getCurrentUserFilters(),"all"==this.filters.users[0]&&(this.filters.users=[])}_getCurrentUserFilters(){return this.users.filter(function(e){return e.selected}).map(function(e){return e.value})}_handleItemChange(){this.filters.items=this._getCurrentItemFilters(),"all"==this.filters.items[0]&&(this.filters.items=[])}_getCurrentItemFilters(){return this.items.filter(function(e){return e.selected}).map(function(e){return e.value})}_handleLocationChange(){this.filters.locations=this._getCurrentLocationFilters(),"all"==this.filters.locations[0]&&(this.filters.locations=[])}_getCurrentLocationFilters(){return this.locations.filter(function(e){return e.selected}).map(function(e){return e.value})}_handleStatusChange(){this.filters.states=this._getCurrentStatusFilters(),"all"==this.filters.states[0]&&(this.filters.states=[])}_getCurrentStatusFilters(){return this.states.filter(function(e){return e.selected}).map(function(e){return e.value})}_handleFilterReset(){if(void 0!==this.filters){for(var[e]of Object.entries(this.filters)){var t=document.getElementById("filter-"+e.substring(0,e.length-1));if(t&&void 0!==t)for(var i=t.options.length-1;0<=i;i--){var a=t.options[i].value;t.options[i].style.display="inline",t.options[i].selected=!1,"all"==a&&(t.options[i].selected=!0)}else console.log("filter-"+e.substring(0,e.length-1));this.startDate.value="",this.endDate.value="",this.filters[e]=[]}this.filter()}}_handleFilterUpdate(e){if(void 0!==e.filters)for(var[t,i]of Object.entries(e.filters))for(var a=document.getElementById("filter-"+t),n=a.options.length-1;0<=n;n--){var s=a.options[n].value;"all"===s||i.includes(s)?a.options[n].style.display="inline":a.options[n].style.display="none"}}_reloadData(){this._renderPagination=this._handleRenderPagination.bind(this),this._filterUpdate=this._handleFilterUpdate.bind(this);var t=this;fetch(cb_ajax_bookings.ajax_url,{method:"POST",body:this.listParams}).then(function(e){return e.json()}).then(function(e){t.totalPages=e.total_pages,t._renderPagination(t.totalPages,e.page),t._filterUpdate(e),t.totalPages<2&&void 0!==t.pagination&&(t.pagination.style.display="none");e=t._getItemMarkup(e.data);t._appendMarkupToGrid(e),t.shuffle=new Shuffle(t.element,{itemSelector:".js-item",sizer:".my-sizer-element"})})}_handleRenderPagination(a,n){if(this.pagination.innerHTML="",1<this.totalPages){let i="<ul>";for(let t=1;t<=a;t++){let e="";t==n&&(e=' class="active" '),(1==t||t==a||t<parseInt(n)+3&&t>parseInt(n)-3)&&(i+='<li data-page="'+t+'"'+e+">"+t+"</li>"),t!=parseInt(n)+3&&t!=parseInt(n)-3||(i+="<li >...</li>")}i+="</ul",this.pagination.insertAdjacentHTML("beforeend",i),this.pagination.style.display="block",this._bindPaginationHandler()}else this.pagination.style.display="none"}_bindPaginationHandler(){this._onPageChange=this._handlePageChange.bind(this);var t=this;document.querySelectorAll("#booking-list--pagination ul li").forEach(function(e){e.dataset.page&&e.addEventListener("click",t._onPageChange)})}_handlePageChange(e){e=e.currentTarget.dataset.page;this.listParams.set("page",e),this._reloadData()}_handleMenuButton(){jQuery(".cb-dropdown-content").toggle()}filter(){jQuery("#filter").addClass("loading"),this.hasActiveFilters()?(this.filters.startDate.length?this.listParams.set("startDate",this.filters.startDate):this.listParams.delete("startDate"),this.filters.endDate.length?this.listParams.set("endDate",this.filters.endDate):this.listParams.delete("endDate"),this.filters.items.length?this.listParams.set("item",this.filters.items[0]):this.listParams.delete("item"),this.filters.users.length?this.listParams.set("user",this.filters.users[0]):this.listParams.delete("user"),this.filters.locations.length?this.listParams.set("location",this.filters.locations[0]):this.listParams.delete("location"),this.filters.states.length?this.listParams.set("status",this.filters.states[0]):this.listParams.delete("status"),this.shuffle.filter(this.itemPassesFilters.bind(this))):(this._resetListParams(),this.shuffle.filter(Shuffle.ALL_ITEMS)),this._reloadData(),jQuery("#filter").removeClass("loading")}hasActiveFilters(){return Object.keys(this.filters).some(function(e){return 0<this.filters[e].length},this)}itemPassesFilters(e){var t=this.filters.users,i=this.filters.items,a=this.filters.locations,n=this.filters.states,s=e.getAttribute("data-user"),r=e.getAttribute("data-item"),o=e.getAttribute("data-location"),e=e.getAttribute("data-status");return!(0<t.length&&!t.includes(s)||0<i.length&&!i.includes(r)||0<a.length&&!a.includes(o)||0<n.length&&!n.includes(e))}_initItemElement(e){var t=document.createElement("div");return t.classList.add("js-item"),t.classList.add("cb-wrapper"),t.dataset.user=e.user,t.dataset.item=e.item,t.dataset.location=e.location,t}_initHeadlineElement(e){var t=document.createElement("p"),i=(t.classList.add("js-item--headline"),document.createElement("span")),a=(i.classList.add("cb-date"),i.innerText=e.startDateFormatted+" - "+e.endDateFormatted,document.createElement("span"));return a.classList.add("cb-title"),a.innerText=e.item+" @ "+e.location,t.append(i),t.append(a),e.bookingCode&&((i=document.createElement("span")).classList.add("cb-booking-code"),i.innerText=e.bookingCode.label+": "+e.bookingCode.value,t.append(i)),t}_initContentElement(e){var t,i,a=document.createElement("div");a.classList.add("js-item--infos");let n="";for([t,i]of Object.entries(e.content))n+="<span>"+i.label+": "+i.value+"</span>";return n+="",a.innerHTML=n,a}_initActionsElement(e){var t=document.createElement("div");return t.classList.add("js-item--action"),t.classList.add("cb-action"),t.insertAdjacentHTML("beforeend",e.actions),t}_getMarkupFromData(e){var t=this._initItemElement(e),i=document.createElement("div");return i.classList.add("content-wrapper"),i.append(this._initHeadlineElement(e)),i.append(this._initContentElement(e)),i.append(this._initActionsElement(e)),t.append(i),t.outerHTML}_getItemMarkup(e){let i=this;return e?e.reduce(function(e,t){return e+i._getMarkupFromData(t)},""):""}_appendMarkupToGrid(e){this.element.innerHTML="",this.element.insertAdjacentHTML("beforeend",e)}_addSorting(){var e=document.getElementById("sorting");e&&(e.addEventListener("change",this._handleSortChange.bind(this)),e=document.getElementById("order"))&&e.addEventListener("change",this._handleSortChange.bind(this))}_handleSortChange(){var e=document.getElementById("sorting"),e=e.options[e.selectedIndex].value,t=document.getElementById("order"),t=t.options[t.selectedIndex].value;this.listParams.set("sort",e),this.listParams.set("order",t),this._reloadData()}}document.addEventListener("DOMContentLoaded",()=>{var e=document.getElementById("booking-list--results");e&&(window.demo=new BookingList(e)),jQuery("#cb-booking-comment").keyup(function(){jQuery("input[type=hidden][name=comment]").val(this.value)})}),document.addEventListener("DOMContentLoaded",function(e){if("undefined"!=typeof calendarData){let n=calendarData,s=!1;const l=()=>{jQuery("#litepicker .litepicker .container__days").css("visibility","hidden")},d=()=>{jQuery("#litepicker .litepicker .container__days").fadeTo("fast",1)},c=()=>{t.find("select[name=repetition-start]").change(function(){a()})},a=()=>{var e=jQuery("#booking-form"),t=e.find("select[name=repetition-start]"),e=e.find("select[name=repetition-end]");const i=t.val();let a=!1,n=!1;e.find("option").each(function(){jQuery(this).val()<i||a||"true"==this.dataset.booked?(jQuery(this).attr("disabled","disabled"),jQuery(this).prop("selected",!1)):(jQuery(this).removeAttr("disabled"),n||(jQuery(this).prop("selected",!0),n=!0)),jQuery(this).val()>i&&"true"==this.dataset.booked&&(a=!0)})},h=(a,e,n="start",s=!1)=>{a.empty().attr("required","required"),jQuery.each(e,function(e,t){var i=new Option(t.timestart+" - "+t.timeend,t["timestamp"+n],s,s);t.disabled&&(i.disabled=!0),t.timeframe.locked&&(i.disabled=!0,i.dataset.booked=!0),a.append(i)})},u=()=>window.matchMedia("(orientation: portrait)").matches?"portrait":"landscape",m=e=>{s=e;var t=n.days[moment(e).format("YYYY-MM-DD")],e=moment(e).format("DD.MM.YYYY");jQuery(".time-selection.repetition-start").find(".hint-selection").hide(),jQuery(".time-selection.repetition-end").find(".hint-selection").show(),jQuery("#resetPicker").css("display","inline-block"),jQuery("#calendarNotice").css("display","inherit");jQuery("#booking-form select[name=repetition-end],#booking-form .time-selection.repetition-end .date").hide(),jQuery("#booking-form input[type=submit]").attr("disabled","disabled");var i=jQuery("#booking-form select[name=repetition-start]");jQuery(".time-selection.repetition-start span.date").text(e),h(i,t.slots,"start",t.fullDay),t.fullDay?jQuery(".time-selection.repetition-start").find("select").hide():jQuery(".time-selection.repetition-start").find("select").show()},f=()=>{var e,t,i;jQuery("div.repetition-start span.date").text()!==jQuery("div.repetition-end span.date").text()&&(jQuery.fn.reverse=[].reverse,e=jQuery("#booking-form select[name=repetition-start]"),t=!1,jQuery("option",e).each(function(){"disabled"===jQuery(this).attr("disabled")&&(t=!0)}),t)&&(i=!1,jQuery("option",e).reverse().each(function(){var e=jQuery(this);i&&"disabled"===i.attr("disabled")?e.attr("disabled","disabled"):("disabled"!==e.attr("disabled")&&e.attr("selected","selected"),i=e)}))},y=e=>{var t=n.days[moment(e).format("YYYY-MM-DD")],e=moment(e).format("DD.MM.YYYY"),i=(jQuery(".time-selection.repetition-end").find(".hint-selection").hide(),jQuery("#booking-form select[name=repetition-end]"));jQuery(".time-selection.repetition-end span.date").text(e),h(i,t.slots,"end",t.fullDay),jQuery("#booking-form select[name=repetition-end],#booking-form .time-selection.repetition-end .date").show(),jQuery("#booking-form input[type=submit]").removeAttr("disabled"),a(),t.fullDay?jQuery(".time-selection.repetition-end").find("select").hide():jQuery(".time-selection.repetition-end").find("select").show()},p=(e,t)=>{n.days[moment(e).format("YYYY-MM-DD")],n.days[moment(t).format("YYYY-MM-DD")],n.days[moment(e).format("YYYY-MM-DD")],n.days[moment(t).format("YYYY-MM-DD")];let i=0;for(var a in n.days)moment(a).isBetween(moment(e).format("YYYY-MM-DD"),moment(t).format("YYYY-MM-DD"))&&(n.days[a].holiday||n.days[a].locked)&&i++;jQuery('input[name="days-overbooked"]').val(i)},g=()=>{let e=2;var t;return t="portrait"===u(),e=window.matchMedia(`(max-device-${t?"width":"height"}: 480px)`).matches&&(e=1,window.innerHeight<window.innerWidth)?2:e};let r=g(),e=r,o=!1;var i=()=>{o=new Litepicker({element:document.getElementById("litepicker"),minDate:moment().format("YYYY-MM-DD"),startDate:moment().isAfter(n.startDate)?moment().format("YYYY-MM-DD"):n.startDate,scrollToDate:!0,inlineMode:!0,firstDay:1,countLockedDays:n.countLockDaysInRange,countLockedDaysMax:n.countLockDaysMaxDays,lang:n.lang,numberOfMonths:r,numberOfColumns:e,moveByOneMonth:!0,singleMode:!1,showWeekNumbers:!1,autoApply:!0,bookedDaysInclusivity:"[]",anyBookedDaysAsCheckout:!1,disallowBookedDaysInRange:!0,disallowPartiallyBookedDaysInRange:!0,disallowLockDaysInRange:n.disallowLockDaysInRange,disallowHolidaysInRange:n.disallowLockDaysInRange,mobileFriendly:!0,mobileCalendarMonthCount:n.mobileCalendarMonthCount,selectForward:!0,useResetBtn:!0,maxDays:n.maxDays,buttonText:{apply:n["i18n.buttonText.apply"],cancel:n["i18n.buttonText.cancel"]},onAutoApply:e=>{e&&(jQuery("#booking-form").show(),jQuery(".cb-notice.date-select").hide())},resetBtnCallback:()=>{jQuery("#booking-form").hide(),jQuery(".cb-notice.date-select").show()},onChangeMonth:function(e,t){l();const i=moment(e.format("YYYY-MM-DD")).format("YYYY-MM-DD");var a=moment(e.format("YYYY-MM-DD")).date(0).format("YYYY-MM-DD"),e=moment(e.format("YYYY-MM-DD")).add(r,"months").date(1).format("YYYY-MM-DD");jQuery.post(cb_ajax.ajax_url,{_ajax_nonce:cb_ajax.nonce,action:"cb_calendar_data",item:jQuery("#booking-form input[name=item-id]").val(),location:jQuery("#booking-form input[name=location-id]").val(),sd:a,ed:e},function(e){jQuery.extend(n.days,e.days),D(e),o.gotoDate(i)})}}),jQuery("#litepicker .litepicker").hide(),jQuery(window).on("orientationchange",function(e){o.setOptions({numberOfMonths:g(),numberOfColumns:g()})})};const D=a=>{l(),o.setOptions({minDate:moment().isAfter(a.startDate)?moment().format("YYYY-MM-DD"):a.startDate,maxDate:a.endDate,startDate:moment().isAfter(a.startDate)?moment().format("YYYY-MM-DD"):a.startDate,days:a.days,maxDays:a.maxDays,lockDays:a.lockDays,countLockedDays:a.countLockDaysInRange,bookedDays:a.bookedDays,partiallyBookedDays:a.partiallyBookedDays,highlightedDays:a.highlightedDays,holidays:a.holidays,onDaySelect:function(e,t){0<=t&&(jQuery("#booking-form").show(),1==t&&(m(e),jQuery(".cb-notice.date-select").hide()),2==t)&&(y(e),f(),p(s,e))},onSelect:function(e,t){jQuery("#booking-form").show(),jQuery(".cb-notice.date-select").hide();var e=a.days[moment(e).format("YYYY-MM-DD")],i=a.days[moment(t).format("YYYY-MM-DD")];y(t),e.fullDay&&i.fullDay||c()}}),d()};jQuery("#resetPicker").on("click",function(e){e.preventDefault(),o.clearSelection(),s=!1,jQuery(".hint-selection").show(),jQuery(".time-selection .date").text(""),jQuery(".time-selection select").hide(),jQuery("#resetPicker").hide(),jQuery("#calendarNotice").hide(),jQuery("#booking-form input[type=submit]").attr("disabled","disabled")});let t=jQuery("#booking-form");t.length&&(i(),D(n))}});